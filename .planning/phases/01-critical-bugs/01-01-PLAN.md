---
phase: 01-critical-bugs
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/TravelSegment/AddTravelStopModal.jsx
  - frontend/src/components/Trip/TripCard.jsx
autonomous: true

must_haves:
  truths:
    - "User can search for stops and see place suggestions from geocoding API"
    - "User sees route start and end cities displayed on trip card"
  artifacts:
    - path: "frontend/src/components/TravelSegment/AddTravelStopModal.jsx"
      provides: "Stop geocoding search functionality"
      contains: "q=${encodeURIComponent"
    - path: "frontend/src/components/Trip/TripCard.jsx"
      provides: "Route endpoint display"
      contains: "origin_name"
  key_links:
    - from: "frontend/src/components/TravelSegment/AddTravelStopModal.jsx"
      to: "/api/v1/google-places/autocomplete"
      via: "fetch with q= parameter"
      pattern: "google-places/autocomplete\\?q="
    - from: "frontend/src/components/Trip/TripCard.jsx"
      to: "trip.origin_name"
      via: "prop access and render"
      pattern: "trip\\.origin_name"
---

<objective>
Fix two frontend bugs: stop geocoding parameter mismatch (BUG-02) and missing route display on trip cards (BUG-03).

Purpose: Restore core user workflows - adding stops to travel segments and seeing trip route information at a glance.
Output: Working stop search with API suggestions; trip cards showing route start/end cities.
</objective>

<execution_context>
@/Users/adrihp06/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adrihp06/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-critical-bugs/01-RESEARCH.md

# Working reference for geocoding pattern
@frontend/src/components/Map/QuickPOISearch.jsx

# Files to modify
@frontend/src/components/TravelSegment/AddTravelStopModal.jsx
@frontend/src/components/Trip/TripCard.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix stop geocoding parameter (BUG-02)</name>
  <files>frontend/src/components/TravelSegment/AddTravelStopModal.jsx</files>
  <action>
Fix the API parameter mismatch in AddTravelStopModal.jsx around line 64-65.

Current (broken):
```javascript
const response = await fetch(
  `${API_BASE_URL}/google-places/autocomplete?query=${encodeURIComponent(searchQuery)}`
);
```

Change to (working):
```javascript
const response = await fetch(
  `${API_BASE_URL}/google-places/autocomplete?q=${encodeURIComponent(searchQuery)}`
);
```

The API endpoint `/api/v1/google-places/autocomplete` expects `q` as the query parameter (defined in app/api/google_places.py line 11-17), not `query`. Reference the working pattern in QuickPOISearch.jsx line 62.

This is a single character change: `query=` -> `q=`
  </action>
  <verify>
1. Run frontend dev server
2. Navigate to a trip with travel segments
3. Click to add a stop to a segment
4. Type a search query (e.g., "coffee shop")
5. Verify suggestions appear (no console errors, no 422 responses in network tab)
  </verify>
  <done>Typing in the stop search field returns place suggestions from the Google Places API without errors</done>
</task>

<task type="auto">
  <name>Task 2: Add route display to TripCard (BUG-03)</name>
  <files>frontend/src/components/Trip/TripCard.jsx</files>
  <action>
Add route start/end display to TripCard component.

The trip object already contains:
- `trip.origin_name` - Starting location name
- `trip.destinations` - Array with `city_name` for each destination
- `trip.return_name` - Return location name (optional)

Add a route info section to the TripCard that shows:
- Start: `trip.origin_name` OR first destination's `city_name`
- End: Last destination's `city_name` OR `trip.return_name`

Implementation pattern (from RESEARCH.md):
```jsx
// Add useMemo for route calculation
const routeInfo = useMemo(() => {
  const start = trip.origin_name || trip.destinations?.[0]?.city_name;
  const end = trip.destinations?.[trip.destinations.length - 1]?.city_name
              || trip.return_name;
  if (!start && !end) return null;
  return { start, end };
}, [trip.origin_name, trip.return_name, trip.destinations]);
```

Add to the render section (near the existing location/MapPin display):
```jsx
{routeInfo && (
  <div className="flex items-center text-sm text-gray-600 dark:text-gray-300">
    <MapPin className="w-4 h-4 mr-1.5" />
    <span className="truncate">{routeInfo.start}</span>
    <ArrowRight className="w-3 h-3 mx-1.5 text-gray-400" />
    <span className="truncate">{routeInfo.end}</span>
  </div>
)}
```

If ArrowRight icon is not already imported, add it from lucide-react.

Use optional chaining (`?.`) throughout to handle trips with no destinations gracefully.
  </action>
  <verify>
1. Navigate to the trips list view (GlobalTripView)
2. Observe trip cards with destinations
3. Verify route start -> end is displayed (e.g., "Paris -> Rome")
4. Verify trips without destinations don't crash (graceful handling)
5. Verify the styling matches existing card elements
  </verify>
  <done>Trip cards display route start and end cities; empty/no-destination trips render without errors</done>
</task>

</tasks>

<verification>
1. Stop search works: Type in AddTravelStopModal, see API suggestions
2. Trip cards show routes: Cards display "Start -> End" for trips with destinations
3. No regressions: Existing trip card functionality unchanged
4. No console errors on any trip card (with or without destinations)
</verification>

<success_criteria>
- BUG-02: Stop geocoding returns suggestions (not 422 errors)
- BUG-03: Trip cards display route endpoints visually
- Both bugs verified with manual testing
</success_criteria>

<output>
After completion, create `.planning/phases/01-critical-bugs/01-01-SUMMARY.md`
</output>
